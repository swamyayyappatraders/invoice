<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Invoice</title>

<!-- Google font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="style.css">

</head>
<body>
  <div class="page">
    <div class="invoice-box">
      <header class="inv-header">
        <div class="logo-area">
          <img src="logo.png" alt="Logo" class="logo" />
        </div>
        <div class="title-area">
          <h1 class="shop-name">SRI SWAMY AYYAPPA TRADERS</h1>
          <div class="shop-addr">Mahatma Gandhi Wholesale Commercial Complex<br>Shop No 397, Gollapudi, Vijayawada - 521225</div>
          <div class="gst"><strong>GSTIN:</strong> <span id="gst">37AUTPV5283H1ZO</span></div>
        </div>
      </header>

      <hr class="divider">

      <section class="meta-grid">
        <div class="meta-left">
          <div><strong>Invoice No:</strong> <span id="invoiceID"></span></div>
          <div><strong>Customer Name:</strong> <span id="customerName"></span></div>
        </div>
        <div class="meta-right">
          <div><strong>Date:</strong> <span id="invoiceDate"></span></div>
          <div><strong>Phone:</strong> <span id="customerPhone"></span></div>
        </div>
      </section>

      <section class="items">
        <table id="itemsTable" class="items-table">
          <thead>
            <tr>
              <th class="col-desc">Description</th>
              <th class="col-qty">Qty (KG)</th>
              <th class="col-rate">Rate</th>
              <th class="col-amount">Amount</th>
            </tr>
          </thead>
          <tbody id="itemsBody">
            <!-- rows inserted by JS -->
          </tbody>
        </table>
      </section>

      <section class="summary">
        <div class="summary-left">
          <div class="notes"><strong>Notes:</strong><div id="notes">None</div></div>
        </div>
        <div class="summary-right">
          <div class="line"><span>Total Amount:</span> <span id="totalAmount" class="amt"></span></div>
          <div class="line"><span>Paid Amount:</span> <span id="paidAmount" class="amt"></span></div>
          <div class="line"><span>Balance:</span> <span id="balance" class="amt"></span></div>
          <div class="line words"><strong>Amount in words:</strong> <em id="amountWords"></em></div>
        </div>
      </section>

      <hr class="divider thin">

      <section class="signature-row">
        <div class="left-col"></div>
        <div class="right-col">
          <div class="signature-line">______________________________</div>
          <div class="signature-label">Authorised Signature</div>
        </div>
      </section>

      <footer class="inv-footer">
        <div class="thank">Thank you for your business! üôè</div>
        <div class="small">This is a computer-generated invoice.</div>
      </footer>
    </div>
  </div>

<script>
/*
  Expected URL parameters (AppSheet action should build URL):
  invoiceID, invoiceDate, customerName, customerPhone,
  product, qty, rate, amount, totalAmount, paidAmount, balance, notes

  For multiple items: pass comma-separated values:
  product=GN,SP  & qty=100,200  & rate=100,120  & amount=10000,24000
*/

// helper: read params
const params = new URLSearchParams(window.location.search);
const get = (k)=> params.get(k) || '';

// fill meta
document.getElementById('invoiceID').innerText = get('invoiceID') || '‚Äî';
document.getElementById('invoiceDate').innerText = get('invoiceDate') || '';
document.getElementById('customerName').innerText = get('customerName') || '';
document.getElementById('customerPhone').innerText = get('customerPhone') || '';
document.getElementById('notes').innerText = get('notes') || 'None';

// parse items (comma separated)
function splitList(s){
  if(!s) return [];
  // decode plus signs etc
  try { s = decodeURIComponent(s); } catch(e){}
  return s.split(',').map(x=> x.trim());
}

const products = splitList(get('product'));
const qtys = splitList(get('qty'));
const rates = splitList(get('rate'));
const amounts = splitList(get('amount'));

// compute rowsCount as max length among products/qtys/rates/amounts
const rowsCount = Math.max(products.length, qtys.length, rates.length, amounts.length, 1);

// insert rows
const tbody = document.getElementById('itemsBody');
for(let i=0;i<rowsCount;i++){
  const tr = document.createElement('tr');

  const desc = document.createElement('td'); desc.className='col-desc';
  desc.innerText = products[i] || '';
  const qtd = document.createElement('td'); qtd.className='col-qty';
  qtd.innerText = qtys[i] || '';
  const rate = document.createElement('td'); rate.className='col-rate';
  rate.innerText = rates[i] ? '‚Çπ' + rates[i] : '';
  const amt = document.createElement('td'); amt.className='col-amount';
  amt.innerText = amounts[i] ? '‚Çπ' + amounts[i] : '';

  tr.appendChild(desc);
  tr.appendChild(qtd);
  tr.appendChild(rate);
  tr.appendChild(amt);
  tbody.appendChild(tr);
}

// totals and display. Ensure numeric cast from params (TotalAmount decimal type from AppSheet)
function asNumber(s){
  if(!s) return 0;
  // remove commas
  return Number(String(s).replace(/,/g,''));
}

const total = asNumber(get('totalAmount'));
const paid = asNumber(get('paidAmount'));
const bal = asNumber(get('balance'));

document.getElementById('totalAmount').innerText = total ? '‚Çπ' + numberWithCommas(total.toFixed(2).replace(/\.00$/,'')) : '‚Çπ0';
document.getElementById('paidAmount').innerText = paid ? '‚Çπ' + numberWithCommas(paid.toFixed(2).replace(/\.00$/,'')) : '‚Çπ0';
document.getElementById('balance').innerText = bal ? '‚Çπ' + numberWithCommas(bal.toFixed(2).replace(/\.00$/,'')) : '‚Çπ0';

// amount in words (Indian)
document.getElementById('amountWords').innerText = toIndianWords(Math.round(total)) + ' Only';

// utilities
function numberWithCommas(x){
  if(x===undefined || x===null) return x;
  const parts = String(x).split('.');
  parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  return parts.join('.');
}

/* Convert number to words in Indian system */
function toIndianWords(num){
  if(isNaN(num)) return '';
  if(num===0) return 'Zero';
  const ones = ['','One','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten',
    'Eleven','Twelve','Thirteen','Fourteen','Fifteen','Sixteen','Seventeen','Eighteen','Nineteen'];
  const tens = ['','','Twenty','Thirty','Forty','Fifty','Sixty','Seventy','Eighty','Ninety'];

  function twoDigit(n){
    if(n<20) return ones[n];
    return tens[Math.floor(n/10)] + (n%10 ? ' ' + ones[n%10] : '');
  }

  function threeDigit(n){
    const h = Math.floor(n/100);
    const r = n%100;
    return (h ? ones[h] + ' Hundred' + (r? ' ' : '') : '') + (r ? twoDigit(r) : '');
  }

  // split into groups: ones, thousands, lakhs, crores
  let crore = Math.floor(num / 10000000);
  num = num % 10000000;
  let lakh = Math.floor(num / 100000);
  num = num % 100000;
  let thousand = Math.floor(num / 1000);
  num = num % 1000;
  let rest = num; // 0..999

  const parts = [];
  if(crore) parts.push( threeDigit(crore) + ' Crore' );
  if(lakh) parts.push( (lakh<100? twoDigit(lakh) : threeDigit(lakh)) + ' Lakh' );
  if(thousand) parts.push( (thousand<100? twoDigit(thousand) : threeDigit(thousand)) + ' Thousand' );
  if(rest) parts.push( threeDigit(rest) );
  return parts.join(' ').trim();
}
</script>
</body>
</html>
