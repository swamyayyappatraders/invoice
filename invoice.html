<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Invoice</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="invoice-wrapper">

    <!-- HEADER -->
    <div class="header">
        <img src="logo.png" class="logo">
        <div class="company-info">
            <h2>SRI SWAMY AYYAPPA TRADERS</h2>
            <p>
                Mahatma Gandhi Wholesale Commercial Complex<br>
                Shop No 397, Gollapudi, Vijayawada ‚Äì 521225<br>
                <b>GSTIN:</b> 37AUTPV5283H1ZO
            </p>
        </div>
    </div>

    <hr class="divider">

    <!-- INVOICE & CUSTOMER INFO -->
    <div class="info-row">
        <div><b>Invoice No:</b> <span id="invoiceID"></span></div>
        <div><b>Date:</b> <span id="invoiceDate"></span></div>
    </div>

    <div class="info-row">
        <div><b>Customer Name:</b> <span id="customerName"></span></div>
        <div><b>Phone:</b> <span id="customerPhone"></span></div>
    </div>

    <hr class="divider">

    <!-- TABLE -->
    <table class="item-table">
        <thead>
            <tr>
                <th>Description</th>
                <th>Qty (KG)</th>
                <th>Rate</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody id="itemTableBody"></tbody>
    </table>

    <hr class="divider">

    <!-- TOTALS -->
    <div class="totals">
        <div><b>Total Amount:</b> ‚Çπ<span id="totalAmount"></span></div>
        <div><b>Paid Amount:</b> ‚Çπ<span id="paidAmount"></span></div>
        <div><b>Balance:</b> ‚Çπ<span id="balance"></span></div>
        <div><b>Amount in words:</b> <i><span id="amountWords"></span></i></div>
    </div>

    <hr class="divider">

    <!-- NOTES -->
    <div class="notes">
        <b>Notes:</b><br>
        <span id="notes"></span>
    </div>

    <br><br>

    <!-- SIGNATURE -->
    <div class="signature">
        <div class="sign-line"></div>
        <div>Authorised Signature</div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        Thank you for your business! üôè <br>
        <small>This is a computer-generated invoice.</small>
    </div>

</div>

<script>
// Get URL params
const p = new URLSearchParams(window.location.search);

// Fill simple values
document.getElementById("invoiceID").innerText = p.get("invoiceID");
document.getElementById("invoiceDate").innerText = p.get("invoiceDate");
document.getElementById("customerName").innerText = p.get("customerName");
document.getElementById("customerPhone").innerText = p.get("customerPhone");
document.getElementById("paidAmount").innerText = p.get("paidAmount");
document.getElementById("balance").innerText = p.get("balance");
document.getElementById("notes").innerText = p.get("notes");


// MULTI-ITEM PARSE
let itemsRaw = p.get("items");
itemsRaw = decodeURIComponent(itemsRaw);

let items = [];
try { items = JSON.parse(itemsRaw); } 
catch(e) { console.log("JSON Parse Error:", e); }

// Build table rows
let total = 0;
let html = "";

items.forEach(item => {
    let amount = item.qty * item.rate;
    total += amount;

    html += `
        <tr>
            <td>${item.desc}</td>
            <td>${item.qty}</td>
            <td>‚Çπ${item.rate}</td>
            <td>‚Çπ${amount}</td>
        </tr>`;
});

document.getElementById("itemTableBody").innerHTML = html;

// Display totals
document.getElementById("totalAmount").innerText = total;

// Convert amount to words
function numberToWords(num) {
    const a = ["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];
    const b = ["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];

    if (num < 20) return a[num];
    if (num < 100) return b[Math.floor(num/10)] + " " + a[num%10];
    if (num < 1000) return a[Math.floor(num/100)] + " Hundred " + numberToWords(num%100);
    if (num < 100000) return numberToWords(Math.floor(num/1000)) + " Thousand " + numberToWords(num%1000);
    return "";
}

document.getElementById("amountWords").innerText =
    numberToWords(total) + " Only";

</script>

</body>
</html>
